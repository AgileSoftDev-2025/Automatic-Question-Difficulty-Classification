{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="max-w-3xl mx-auto">
        <h1 class="text-4xl font-bold text-gray-900 mb-8">Upload Soal</h1>
        
        {% if messages %}
        <div class="mb-8">
            {% for message in messages %}
            <div class="p-4 mb-4 rounded-lg {% if message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="bg-white rounded-xl shadow-sm p-8">
            <form method="POST" enctype="multipart/form-data" class="space-y-6">
                {% csrf_token %}
                
                <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-500 transition-colors">
                    <input type="file" id="file-input" name="file" accept=".txt,.doc,.docx,.rtf,.pdf,.odt,.xls,.xlsx,.csv,.ppt,.pptx,.odf,.ods,.odp" class="hidden">
                    <label for="file-input" class="cursor-pointer">
                        <i class="bi bi-cloud-upload text-4xl text-blue-500 mb-4 block"></i>
                        <p class="text-gray-600 mb-2">Drop file soal di sini atau</p>
                        <span class="text-blue-600 font-semibold hover:text-blue-700">Pilih file</span>
                    </label>
                </div>

                <div id="file-preview" class="hidden items-center justify-between p-4 border border-gray-300 rounded-lg bg-gray-50">
                    <div class="flex items-center space-x-3 overflow-hidden">
                        <i class="bi bi-file-earmark-text text-2xl text-gray-600 flex-shrink-0"></i>
                        <span id="file-name" class="font-medium text-gray-800 truncate"></span>
                    </div>
                    <button type="button" id="remove-file-btn" class="text-red-500 hover:text-red-700 font-semibold ml-4 flex-shrink-0">
                        Remove
                    </button>
                </div>

                <button type="submit" 
                        id="upload-btn"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors
                               disabled:bg-gray-400 disabled:cursor-not-allowed"
                        disabled>
                    Upload & Klasifikasi
                </button>
            </form>
        </div>
        
        <div class="mt-8 bg-blue-50 rounded-xl p-6">
            <h3 class="font-semibold mb-4">Format File yang Didukung:</h3>
            <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                <div>
                    <p>• Text files (.txt)</p>
                    <p>• Word documents (.doc, .docx)</p>
                    <p>• PDF files (.pdf)</p>
                    <p>• Rich Text (.rtf)</p>
                    <p>• OpenDocument Text (.odt)</p>
                </div>
                <div>
                    <p>• Excel files (.xls, .xlsx)</p>
                    <p>• CSV files (.csv)</p>
                    <p>• PowerPoint (.ppt, .pptx)</p>
                    <p>• OpenDocument Spreadsheet (.ods)</p>
                    <p>• OpenDocument Presentation (.odp)</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const uploadBtn = document.getElementById('upload-btn');
    const filePreview = document.getElementById('file-preview');
    const fileNameEl = document.getElementById('file-name');
    const removeFileBtn = document.getElementById('remove-file-btn');

    function handleFileSelect(file) {
        if (!file) return;
        fileNameEl.textContent = file.name;
        filePreview.classList.remove('hidden');
        filePreview.classList.add('flex');
        dropZone.classList.add('hidden');
        uploadBtn.disabled = false;
    }

    function removeFilePreview() {
        fileInput.value = '';
        filePreview.classList.add('hidden');
        filePreview.classList.remove('flex');
        dropZone.classList.remove('hidden');
        uploadBtn.disabled = true;
    }

    removeFileBtn.addEventListener('click', removeFilePreview);
    fileInput.addEventListener('change', (e) => {
        handleFileSelect(e.target.files[0]);
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(
            eventName,
            () => dropZone.classList.add('border-blue-500', 'bg-blue-50'),
            false
        );
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(
            eventName,
            () => dropZone.classList.remove('border-blue-500', 'bg-blue-50'),
            false
        );
    });

    dropZone.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files;
        handleFileSelect(files[0]);
    }, false);
</script>
{% endblock %}